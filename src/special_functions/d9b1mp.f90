!** D9B1MP
SUBROUTINE D9B1MP(X,Ampl,Theta)
  !> Evaluate the modulus and phase for the J1 and Y1 Bessel
  !            functions.
  !***
  ! **Library:**   SLATEC (FNLIB)
  !***
  ! **Category:**  C10A1
  !***
  ! **Type:**      DOUBLE PRECISION (D9B1MP-D)
  !***
  ! **Keywords:**  BESSEL FUNCTION, FNLIB, MODULUS, PHASE, SPECIAL FUNCTIONS
  !***
  ! **Author:**  Fullerton, W., (LANL)
  !***
  ! **Description:**
  !
  ! Evaluate the modulus and phase for the Bessel J1 and Y1 functions.
  !
  ! Series for BM1        on the interval  1.56250E-02 to  6.25000E-02
  !                                        with weighted error   4.91E-32
  !                                         log weighted error  31.31
  !                               significant figures required  30.04
  !                                    decimal places required  32.09
  !
  ! Series for BT12       on the interval  1.56250E-02 to  6.25000E-02
  !                                        with weighted error   3.33E-32
  !                                         log weighted error  31.48
  !                               significant figures required  31.05
  !                                    decimal places required  32.27
  !
  ! Series for BM12       on the interval  0.          to  1.56250E-02
  !                                        with weighted error   5.01E-32
  !                                         log weighted error  31.30
  !                               significant figures required  29.99
  !                                    decimal places required  32.10
  !
  ! Series for BTH1       on the interval  0.          to  1.56250E-02
  !                                        with weighted error   2.82E-32
  !                                         log weighted error  31.55
  !                               significant figures required  31.12
  !                                    decimal places required  32.37
  !
  !***
  ! **See also:**  DBESJ1, DBESY1
  !***
  ! **References:**  (NONE)
  !***
  ! **Routines called:**  D1MACH, DCSEVL, INITDS, XERMSG

  !* REVISION HISTORY  (YYMMDD)
  !   770701  DATE WRITTEN
  !   890531  Changed all specific intrinsics to generic.  (WRB)
  !   890531  REVISION DATE from Version 3.2
  !   891214  Prologue converted to Version 4.0 format.  (BAB)
  !   900315  CALLs to XERROR changed to CALLs to XERMSG.  (THJ)
  !   900720  Routine changed from user-callable to subsidiary.  (WRB)
  !   920618  Removed space from variable name and code restructured to
  !           use IF-THEN-ELSE.  (RWC, WRB)
  USE service, ONLY : XERMSG, D1MACH
  REAL(DP) :: X, Ampl, Theta
  REAL(DP) :: z
  INTEGER, SAVE :: nbm1, nbt12, nbm12, nbth1
  REAL(DP), PARAMETER :: eta = 0.1_DP*D1MACH(3), xmax = 1._DP/D1MACH(4)
  REAL(DP), PARAMETER :: bm1cs(37) = [ +.1069845452618063014969985308538E+0_DP, &
    +.3274915039715964900729055143445E-2_DP, -.2987783266831698592030445777938E-4_DP, &
    +.8331237177991974531393222669023E-6_DP, -.4112665690302007304896381725498E-7_DP, &
    +.2855344228789215220719757663161E-8_DP, -.2485408305415623878060026596055E-9_DP, &
    +.2543393338072582442742484397174E-10_DP, -.2941045772822967523489750827909E-11_DP, &
    +.3743392025493903309265056153626E-12_DP, -.5149118293821167218720548243527E-13_DP, &
    +.7552535949865143908034040764199E-14_DP, -.1169409706828846444166290622464E-14_DP, &
    +.1896562449434791571721824605060E-15_DP, -.3201955368693286420664775316394E-16_DP, &
    +.5599548399316204114484169905493E-17_DP, -.1010215894730432443119390444544E-17_DP, &
    +.1873844985727562983302042719573E-18_DP, -.3563537470328580219274301439999E-19_DP, &
    +.6931283819971238330422763519999E-20_DP, -.1376059453406500152251408930133E-20_DP, &
    +.2783430784107080220599779327999E-21_DP, -.5727595364320561689348669439999E-22_DP, &
    +.1197361445918892672535756799999E-22_DP, -.2539928509891871976641440426666E-23_DP, &
    +.5461378289657295973069619199999E-24_DP, -.1189211341773320288986289493333E-24_DP, &
    +.2620150977340081594957824000000E-25_DP, -.5836810774255685901920938666666E-26_DP, &
    +.1313743500080595773423615999999E-26_DP, -.2985814622510380355332778666666E-27_DP, &
    +.6848390471334604937625599999999E-28_DP, -.1584401568222476721192960000000E-28_DP, &
    +.3695641006570938054301013333333E-29_DP, -.8687115921144668243012266666666E-30_DP, &
    +.2057080846158763462929066666666E-30_DP, -.4905225761116225518523733333333E-31_DP ]
  REAL(DP), PARAMETER :: bt12cs(39) = [ +.73823860128742974662620839792764E+0_DP, &
    -.33361113174483906384470147681189E-2_DP, +.61463454888046964698514899420186E-4_DP, &
    -.24024585161602374264977635469568E-5_DP, +.14663555577509746153210591997204E-6_DP, &
    -.11841917305589180567005147504983E-7_DP, +.11574198963919197052125466303055E-8_DP, &
    -.13001161129439187449366007794571E-9_DP, +.16245391141361731937742166273667E-10_DP, &
    -.22089636821403188752155441770128E-11_DP, +.32180304258553177090474358653778E-12_DP, &
    -.49653147932768480785552021135381E-13_DP, +.80438900432847825985558882639317E-14_DP, &
    -.13589121310161291384694712682282E-14_DP, +.23810504397147214869676529605973E-15_DP, &
    -.43081466363849106724471241420799E-16_DP, +.80202544032771002434993512550400E-17_DP, &
    -.15316310642462311864230027468799E-17_DP, +.29928606352715568924073040554666E-18_DP, &
    -.59709964658085443393815636650666E-19_DP, +.12140289669415185024160852650666E-19_DP, &
    -.25115114696612948901006977706666E-20_DP, +.52790567170328744850738380799999E-21_DP, &
    -.11260509227550498324361161386666E-21_DP, +.24348277359576326659663462400000E-22_DP, &
    -.53317261236931800130038442666666E-23_DP, +.11813615059707121039205990399999E-23_DP, &
    -.26465368283353523514856789333333E-24_DP, +.59903394041361503945577813333333E-25_DP, &
    -.13690854630829503109136383999999E-25_DP, +.31576790154380228326413653333333E-26_DP, &
    -.73457915082084356491400533333333E-27_DP, +.17228081480722747930705920000000E-27_DP, &
    -.40716907961286507941068800000000E-28_DP, +.96934745136779622700373333333333E-29_DP, &
    -.23237636337765716765354666666666E-29_DP, +.56074510673522029406890666666666E-30_DP, &
    -.13616465391539005860522666666666E-30_DP, +.33263109233894654388906666666666E-31_DP ]
  REAL(DP), PARAMETER :: bm12cs(40) = [ +.9807979156233050027272093546937E-1_DP, &
    +.1150961189504685306175483484602E-2_DP, -.4312482164338205409889358097732E-5_DP, &
    +.5951839610088816307813029801832E-7_DP, -.1704844019826909857400701586478E-8_DP, &
    +.7798265413611109508658173827401E-10_DP, -.4958986126766415809491754951865E-11_DP, &
    +.4038432416421141516838202265144E-12_DP, -.3993046163725175445765483846645E-13_DP, &
    +.4619886183118966494313342432775E-14_DP, -.6089208019095383301345472619333E-15_DP, &
    +.8960930916433876482157048041249E-16_DP, -.1449629423942023122916518918925E-16_DP, &
    +.2546463158537776056165149648068E-17_DP, -.4809472874647836444259263718620E-18_DP, &
    +.9687684668292599049087275839124E-19_DP, -.2067213372277966023245038117551E-19_DP, &
    +.4646651559150384731802767809590E-20_DP, -.1094966128848334138241351328339E-20_DP, &
    +.2693892797288682860905707612785E-21_DP, -.6894992910930374477818970026857E-22_DP, &
    +.1830268262752062909890668554740E-22_DP, -.5025064246351916428156113553224E-23_DP, &
    +.1423545194454806039631693634194E-23_DP, -.4152191203616450388068886769801E-24_DP, &
    +.1244609201503979325882330076547E-24_DP, -.3827336370569304299431918661286E-25_DP, &
    +.1205591357815617535374723981835E-25_DP, -.3884536246376488076431859361124E-26_DP, &
    +.1278689528720409721904895283461E-26_DP, -.4295146689447946272061936915912E-27_DP, &
    +.1470689117829070886456802707983E-27_DP, -.5128315665106073128180374017796E-28_DP, &
    +.1819509585471169385481437373286E-28_DP, -.6563031314841980867618635050373E-29_DP, &
    +.2404898976919960653198914875834E-29_DP, -.8945966744690612473234958242979E-30_DP, &
    +.3376085160657231026637148978240E-30_DP, -.1291791454620656360913099916966E-30_DP, &
    +.5008634462958810520684951501254E-31_DP ]
  REAL(DP), PARAMETER :: bth1cs(44) = [ +.74749957203587276055443483969695E+0_DP, &
    -.12400777144651711252545777541384E-2_DP, +.99252442404424527376641497689592E-5_DP, &
    -.20303690737159711052419375375608E-6_DP, +.75359617705690885712184017583629E-8_DP, &
    -.41661612715343550107630023856228E-9_DP, +.30701618070834890481245102091216E-10_DP, &
    -.28178499637605213992324008883924E-11_DP, +.30790696739040295476028146821647E-12_DP, &
    -.38803300262803434112787347554781E-13_DP, +.55096039608630904934561726208562E-14_DP, &
    -.86590060768383779940103398953994E-15_DP, +.14856049141536749003423689060683E-15_DP, &
    -.27519529815904085805371212125009E-16_DP, +.54550796090481089625036223640923E-17_DP, &
    -.11486534501983642749543631027177E-17_DP, +.25535213377973900223199052533522E-18_DP, &
    -.59621490197413450395768287907849E-19_DP, +.14556622902372718620288302005833E-19_DP, &
    -.37022185422450538201579776019593E-20_DP, +.97763074125345357664168434517924E-21_DP, &
    -.26726821639668488468723775393052E-21_DP, +.75453300384983271794038190655764E-22_DP, &
    -.21947899919802744897892383371647E-22_DP, +.65648394623955262178906999817493E-23_DP, &
    -.20155604298370207570784076869519E-23_DP, +.63417768556776143492144667185670E-24_DP, &
    -.20419277885337895634813769955591E-24_DP, +.67191464220720567486658980018551E-25_DP, &
    -.22569079110207573595709003687336E-25_DP, +.77297719892989706370926959871929E-26_DP, &
    -.26967444512294640913211424080920E-26_DP, +.95749344518502698072295521933627E-27_DP, &
    -.34569168448890113000175680827627E-27_DP, +.12681234817398436504211986238374E-27_DP, &
    -.47232536630722639860464993713445E-28_DP, +.17850008478186376177858619796417E-28_DP, &
    -.68404361004510395406215223566746E-29_DP, +.26566028671720419358293422672212E-29_DP, &
    -.10450402527914452917714161484670E-29_DP, +.41618290825377144306861917197064E-30_DP, &
    -.16771639203643714856501347882887E-30_DP, +.68361997776664389173535928028528E-31_DP, &
    -.28172247861233641166739574622810E-31_DP ]
  REAL(DP), PARAMETER ::  pi4 = 0.785398163397448309615660845819876_DP
  LOGICAL, SAVE :: first = .TRUE.
  !* FIRST EXECUTABLE STATEMENT  D9B1MP
  IF( first ) THEN
    nbm1 = INITDS(bm1cs,37,eta)
    nbt12 = INITDS(bt12cs,39,eta)
    nbm12 = INITDS(bm12cs,40,eta)
    nbth1 = INITDS(bth1cs,44,eta)
    first = .FALSE.
  END IF
  !
  IF( X<4._DP ) THEN
    CALL XERMSG('D9B1MP','X must be >= 4',1,2)
    Ampl = 0._DP
    Theta = 0._DP
  ELSEIF( X<=8._DP ) THEN
    z = (128._DP/(X*X)-5._DP)/3._DP
    Ampl = (0.75_DP+DCSEVL(z,bm1cs,nbm1))/SQRT(X)
    Theta = X - 3._DP*pi4 + DCSEVL(z,bt12cs,nbt12)/X
  ELSE
    IF( X>xmax ) CALL XERMSG('D9B1MP',&
      'No precision because X is too big',2,2)
    !
    z = 128._DP/(X*X) - 1._DP
    Ampl = (0.75_DP+DCSEVL(z,bm12cs,nbm12))/SQRT(X)
    Theta = X - 3._DP*pi4 + DCSEVL(z,bth1cs,nbth1)/X
  END IF
END SUBROUTINE D9B1MP
